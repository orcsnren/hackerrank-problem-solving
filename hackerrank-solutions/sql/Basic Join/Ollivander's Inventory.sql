SELECT ID,AGE,COINS_NEEDED,POWER FROM ( SELECT ID,AGE,COINS_NEEDED,POWER,ROW_NUMBER() OVER(PARTITION BY AGE,POWER ORDER BY AGE,COINS_NEEDED ASC) RANK FROM WANDS INNER JOIN WANDS_PROPERTY ON WANDS.CODE=WANDS_PROPERTY.CODE WHERE IS_EVIL=0 ) SRC WHERE RANK=1 ORDER BY POWER DESC,AGE DESC;